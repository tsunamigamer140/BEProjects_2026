{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <title>Admin â€“ Subscriptions</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <h2 class="fw-bold mb-4">ðŸ›¡ Admin â€“ Subscription Requests</h2>

      <table class="table table-bordered table-hover bg-white rounded shadow-sm">
        <thead class="table-dark">
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Screenshot</th>
            <th>Status</th>
            <th>Submitted</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for sub in subs %}
          <tr>
            <td>{{ sub.user.username }}</td>
            <td>{{ sub.user.email }}</td>

            <td>
              {% if sub.screenshot %}
              <a
                href="{{ sub.screenshot.url }}"
                target="_blank"
                class="btn btn-sm btn-outline-primary"
              >View</a>
              {% else %}
              <span class="text-muted">No file</span>
              {% endif %}
            </td>

            <!-- STATUS LOGIC FIXED -->
            <td>
              {% if sub.active %}
                <span class="badge bg-success">Approved</span>

              {% elif not sub.active and sub.screenshot %}
                <span class="badge bg-warning text-dark">Pending</span>

              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </td>

            <td>{{ sub.created_at|date:"M d, Y H:i" }}</td>

            <!-- ACTIONS -->
            <td>
              {% if sub.active %}
                <span class="text-muted">âœ“ Approved</span>

              {% elif not sub.active and not sub.screenshot %}
                <span class="text-muted">âœ— Rejected</span>

              {% else %}
                <a href="{% url 'ai_app:approve_subscription' sub.id %}"
                   class="btn btn-success btn-sm">Approve</a>

                <a href="{% url 'ai_app:reject_subscription' sub.id %}"
                   class="btn btn-danger btn-sm">Reject</a>
              {% endif %}
            </td>
          </tr>

          {% empty %}
          <tr>
            <td colspan="6" class="text-center py-3 text-muted">
              No pending subscriptions.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </body>
</html>
